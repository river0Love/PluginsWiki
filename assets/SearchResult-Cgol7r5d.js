import{f as J,u as N,g as X,h as Z,j as ee,t as ae,i as le,k as Q,l as b,m as e,n as se,p as te,s as re,R as I,q as ue,v as ie,x as ne,y as oe,z as ce,A as E,B as $,C as de,D as he,E as me,F as ve,L as ye,G as pe,H as ge,I as De,J as M,K as He,M as C}from"./app-MK6iL6qr.js";const ke=["/Act/","/Dalamud/","/Dalamud/preface.html","/Dalamud/benti/","/Dalamud/benti/anzhuang.html","/Dalamud/benti/gunmyan.html","/Dalamud/benti/jieshao.html","/Dalamud/benti/xl_troubleshooting.html","/Dalamud/gongjv/CharacterSyncX.html","/Dalamud/gongjv/Currency%20Tracker.html","/Dalamud/gongjv/Daily%20Routines.html","/Dalamud/gongjv/HaselTweaks.html","/Dalamud/gongjv/Inviter.html","/Dalamud/gongjv/","/Dalamud/gongjv/YokaiCheck.html","/Dalamud/gongjv/vnavmesh.html","/Dalamud/kaifa/HaselDebug.html","/Dalamud/kaifa/","/Dalamud/meihuanhua/","/Dalamud/meihuanhua/VFXEditor.html","/Dalamud/shengchan/Artisan.html","/Dalamud/shengchan/BOCCHI.html","/Dalamud/shengchan/GatherBuddy.html","/Dalamud/shengchan/Ice.html","/Dalamud/shengchan/LeveHelper.html","/Dalamud/shengchan/MissFisher.html","/Dalamud/shengchan/","/Dalamud/youhua/","/Dalamud/zhandou/A%20Realm%20Recorded.html","/Dalamud/zhandou/AutoDuty.html","/Dalamud/zhandou/BOCCHI.html","/Dalamud/zhandou/DivinationAetheryteLinkInChat.html","/Dalamud/zhandou/FF%20Logs%20Viewer%20.html","/Dalamud/zhandou/FuckAnimationLock.html","/Dalamud/zhandou/HoardFarm.html","/Dalamud/zhandou/Kodakku%20Assist%20.html","/Dalamud/zhandou/LazyLoot.html","/Dalamud/zhandou/NyaDraw.html","/Dalamud/zhandou/","/Dalamud/zhandou/Rotation%20Solver.html","/Dalamud/zhandou/Splatoon.html","/Dalamud/zhandou/Untarnished%20Heart.html","/Dalamud/zhandou/Wrath%20Combo.html","/Dalamud/zhandou/bossmod.html","/404.html","/"],fe="SLIMSEARCH_QUERY_HISTORY",g=M(fe,[]),be=()=>{const{queryHistoryCount:t}=C;return{enabled:t>0,queryHistories:g,addQueryHistory:n=>{g.value=Array.from(new Set([n,...g.value.slice(0,t-1)]))},removeQueryHistory:n=>{g.value=[...g.value.slice(0,n),...g.value.slice(n+1)]}}},q=t=>ke[t.id]+("anchor"in t?`#${t.anchor}`:""),Ce="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:T}=C,D=M(Ce,[]),Re=()=>({enabled:T>0,resultHistories:D,addResultHistory:i=>{{const n={link:q(i),display:i.display};"header"in i&&(n.header=i.header),D.value=[n,...D.value.slice(0,T-1)]}},removeResultHistory:i=>{D.value=[...D.value.slice(0,i),...D.value.slice(i+1)]}}),we=t=>{const{page:i,routeLocale:n}=de(),R=he(),r=Q(0),H=b(()=>r.value>0),d=me([]);return ve(()=>{const{search:w,terminate:v}=ye(),k=ge(y=>{const{resultsFilter:x=s=>s,querySplitter:p,suggestionsFilter:A,...u}=R.value;y?(r.value+=1,w(y,n.value,u).then(s=>x(s,y,n.value,i.value)).then(s=>{r.value-=1,d.value=s}).catch(s=>{console.warn(s),r.value-=1,r.value||(d.value=[])})):d.value=[]},C.searchDelay-C.suggestDelay,{maxWait:5e3});pe([t,n],([y])=>k(y.join(" "))),De(()=>{v()})}),{isSearching:H,results:d}};var ze=J({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:i}){const n=N(),R=X(),r=Z(ee),{addQueryHistory:H,queryHistories:d,removeQueryHistory:w}=be(),{resultHistories:v,addResultHistory:k,removeResultHistory:y}=Re(),x=ae(t,"queries"),{results:p,isSearching:A}=we(x),u=le({isQuery:!0,index:0}),s=Q(0),h=Q(0),F=b(()=>d.value.length>0||v.value.length>0),z=b(()=>p.value.length>0),L=b(()=>p.value[s.value]||null),B=()=>{const{isQuery:a,index:l}=u;l===0?(u.isQuery=!a,u.index=a?v.value.length-1:d.value.length-1):u.index=l-1},O=()=>{const{isQuery:a,index:l}=u;l===(a?d.value.length-1:v.value.length-1)?(u.isQuery=!a,u.index=0):u.index=l+1},U=()=>{s.value=s.value>0?s.value-1:p.value.length-1,h.value=L.value.contents.length-1},_=()=>{s.value=s.value<p.value.length-1?s.value+1:0,h.value=0},Y=()=>{h.value<L.value.contents.length-1?h.value+=1:_()},P=()=>{h.value>0?h.value-=1:U()},S=a=>a.map(l=>He(l)?l:e(l[0],l[1])),V=a=>{if(a.type==="customField"){const l=oe[a.index]||"$content",[m,o=""]=ce(l)?l[R.value].split("$content"):l.split("$content");return a.display.map(c=>e("div",S([m,...c,o])))}return a.display.map(l=>e("div",S(l)))},f=()=>{s.value=0,h.value=0,i("updateQuery",""),i("close")},G=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((a,l)=>{const m=u.isQuery&&u.index===l;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{i("updateQuery",a)}},e("div",[e(E,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},a),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:$,onClick:o=>{o.preventDefault(),o.stopPropagation(),w(l)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},v.value.map((a,l)=>{const m=!u.isQuery&&u.index===l;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e(I,{to:a.link,onClick:()=>{f()}},()=>[e(E,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[a.header?e("div",{class:"slimsearch-record-content-header"},a.header):null,e("div",a.display.map(o=>S(o)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:$,onClick:o=>{o.preventDefault(),o.stopPropagation(),y(l)}})]))}))]));return se("keydown",a=>{if(t.isFocusing){if(z.value){if(a.key==="ArrowUp")P();else if(a.key==="ArrowDown")Y();else if(a.key==="Enter"){const l=L.value.contents[h.value];H(t.queries.join(" ")),k(l),n.push(q(l)),f()}}else if(a.key==="ArrowUp")B();else if(a.key==="ArrowDown")O();else if(a.key==="Enter"){const{index:l}=u;u.isQuery?(a.preventDefault(),i("updateQuery",d.value[l])):(n.push(v.value[l].link),f())}}}),te([s,h],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!z.value:!F.value}]},t.queries.length?A.value?e(re,{hint:r.value.searching}):z.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},p.value.map(({title:a,contents:l},m)=>{const o=s.value===m;return e("div",{class:["slimsearch-record",{active:o}],role:"group","aria-selected":o},[e("div",{class:"slimsearch-record-title"},a||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},l.map((c,W)=>{const j=o&&h.value===W;return e("li",{class:["slimsearch-record-matches",{active:j}],role:"option","aria-selected":j},e(I,{to:q(c),onClick:()=>{H(t.queries.join(" ")),k(c),f()}},()=>[c.type==="text"?null:e(c.type==="title"?ue:c.type==="heading"?ie:ne,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[c.type==="text"&&c.header?e("div",{class:"slimsearch-record-content-header"},c.header):null,e("div",V(c))])]))}))])})):r.value.emptyResult:F.value?[G(),K()]:r.value.emptyHistory)}});export{ze as default};
