import{f as W,u as J,g as X,h as Z,j as ee,t as ae,i as le,k as R,l as b,m as e,n as te,p as se,s as ue,R as I,q as re,v as oe,x as ne,y as ie,z as me,A as E,B as T,C as de,D as he,E as ce,F as ve,L as ge,G as ye,H as De,I as pe,J as B,K as He,M as z}from"./app-B7OrMTCK.js";const ke=["/Act/","/Dalamud/","/Dalamud/preface.html","/Dalamud/benti/","/Dalamud/benti/anzhuang.html","/Dalamud/benti/gunmyan.html","/Dalamud/benti/jieshao.html","/Dalamud/benti/xl_troubleshooting.html","/Dalamud/kaifa/HaselDebug.html","/Dalamud/kaifa/","/Dalamud/gongjv/CharacterSyncX.html","/Dalamud/gongjv/Currency%20Tracker.html","/Dalamud/gongjv/Daily%20Routines.html","/Dalamud/gongjv/DisPlacePlugin.html","/Dalamud/gongjv/HaselTweaks.html","/Dalamud/gongjv/Inviter.html","/Dalamud/gongjv/LatihasChocobo.html","/Dalamud/gongjv/LatihasExport.html","/Dalamud/gongjv/Lifestream.html","/Dalamud/gongjv/LogogramHelperEx.html","/Dalamud/gongjv/MapPartyAssist.html","/Dalamud/gongjv/Marketbuddy.html","/Dalamud/gongjv/MidiBard2.html","/Dalamud/gongjv/PandorasBox.html","/Dalamud/gongjv/","/Dalamud/gongjv/SimpleMapTracker.html","/Dalamud/gongjv/TextAdvance.html","/Dalamud/gongjv/YesAlready.html","/Dalamud/gongjv/YokaiCheck.html","/Dalamud/gongjv/vfallguy.html","/Dalamud/gongjv/vnavmesh.html","/Dalamud/meihuanhua/CharaCradThief.html","/Dalamud/meihuanhua/","/Dalamud/meihuanhua/Umbra.html","/Dalamud/meihuanhua/VFXEditor.html","/Dalamud/shengchan/Artisan.html","/Dalamud/shengchan/AutoHook.html","/Dalamud/shengchan/BOCCHI.html","/Dalamud/shengchan/GatherBuddy.html","/Dalamud/shengchan/Ice.html","/Dalamud/shengchan/LeveHelper.html","/Dalamud/shengchan/MissFisher.html","/Dalamud/shengchan/","/Dalamud/youhua/","/Dalamud/zhandou/A%20Realm%20Recorded.html","/Dalamud/zhandou/AutoDuty.html","/Dalamud/zhandou/BAHelper.html","/Dalamud/zhandou/BOCCHI.html","/Dalamud/zhandou/DivinationAetheryteLinkInChat.html","/Dalamud/zhandou/FF%20Logs%20Viewer%20.html","/Dalamud/zhandou/FuckAnimationLock.html","/Dalamud/zhandou/HoardFarm.html","/Dalamud/zhandou/HuntTrainAssistant.html","/Dalamud/zhandou/IINACTEx.html","/Dalamud/zhandou/Kodakku%20Assist%20.html","/Dalamud/zhandou/LazyLoot.html","/Dalamud/zhandou/NecroLens.html","/Dalamud/zhandou/NyaDraw.html","/Dalamud/zhandou/PalacePal.html","/Dalamud/zhandou/","/Dalamud/zhandou/Rotation%20Solver.html","/Dalamud/zhandou/SSMinionBoradcast.html","/Dalamud/zhandou/SkyEye.html","/Dalamud/zhandou/Splatoon.html","/Dalamud/zhandou/Untarnished%20Heart.html","/Dalamud/zhandou/Wrath%20Combo.html","/Dalamud/zhandou/bossmod.html","/Dalamud/zhandou/pvpauto.html","/404.html","/"],fe="SLIMSEARCH_QUERY_HISTORY",D=B(fe,[]),be=()=>{const{queryHistoryCount:s}=z;return{enabled:s>0,queryHistories:D,addQueryHistory:n=>{D.value=Array.from(new Set([n,...D.value.slice(0,s-1)]))},removeQueryHistory:n=>{D.value=[...D.value.slice(0,n),...D.value.slice(n+1)]}}},w=s=>ke[s.id]+("anchor"in s?`#${s.anchor}`:""),ze="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:M}=z,p=B(ze,[]),je=()=>({enabled:M>0,resultHistories:p,addResultHistory:o=>{{const n={link:w(o),display:o.display};"header"in o&&(n.header=o.header),p.value=[n,...p.value.slice(0,M-1)]}},removeResultHistory:o=>{p.value=[...p.value.slice(0,o),...p.value.slice(o+1)]}}),Ce=s=>{const{page:o,routeLocale:n}=de(),j=he(),u=R(0),H=b(()=>u.value>0),d=ce([]);return ve(()=>{const{search:C,terminate:v}=ge(),k=De(g=>{const{resultsFilter:x=t=>t,querySplitter:y,suggestionsFilter:Q,...r}=j.value;g?(u.value+=1,C(g,n.value,r).then(t=>x(t,g,n.value,o.value)).then(t=>{u.value-=1,d.value=t}).catch(t=>{console.warn(t),u.value-=1,u.value||(d.value=[])})):d.value=[]},z.searchDelay-z.suggestDelay,{maxWait:5e3});ye([s,n],([g])=>k(g.join(" "))),pe(()=>{v()})}),{isSearching:H,results:d}};var Le=W({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(s,{emit:o}){const n=J(),j=X(),u=Z(ee),{addQueryHistory:H,queryHistories:d,removeQueryHistory:C}=be(),{resultHistories:v,addResultHistory:k,removeResultHistory:g}=je(),x=ae(s,"queries"),{results:y,isSearching:Q}=Ce(x),r=le({isQuery:!0,index:0}),t=R(0),h=R(0),q=b(()=>d.value.length>0||v.value.length>0),L=b(()=>y.value.length>0),S=b(()=>y.value[t.value]||null),P=()=>{const{isQuery:a,index:l}=r;l===0?(r.isQuery=!a,r.index=a?v.value.length-1:d.value.length-1):r.index=l-1},$=()=>{const{isQuery:a,index:l}=r;l===(a?d.value.length-1:v.value.length-1)?(r.isQuery=!a,r.index=0):r.index=l+1},U=()=>{t.value=t.value>0?t.value-1:y.value.length-1,h.value=S.value.contents.length-1},O=()=>{t.value=t.value<y.value.length-1?t.value+1:0,h.value=0},Y=()=>{h.value<S.value.contents.length-1?h.value+=1:O()},_=()=>{h.value>0?h.value-=1:U()},A=a=>a.map(l=>He(l)?l:e(l[0],l[1])),N=a=>{if(a.type==="customField"){const l=ie[a.index]||"$content",[c,i=""]=me(l)?l[j.value].split("$content"):l.split("$content");return a.display.map(m=>e("div",A([c,...m,i])))}return a.display.map(l=>e("div",A(l)))},f=()=>{t.value=0,h.value=0,o("updateQuery",""),o("close")},V=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},u.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((a,l)=>{const c=r.isQuery&&r.index===l;return e("li",{class:["slimsearch-record-matches",{active:c}],role:"option","aria-selected":c,onClick:()=>{o("updateQuery",a)}},e("div",[e(E,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},a),e("button",{type:"button",class:"slimsearch-remove-icon",title:u.value.remove,"aria-label":u.value.remove,innerHTML:T,onClick:i=>{i.preventDefault(),i.stopPropagation(),C(l)}})]))}))])),G=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},u.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},v.value.map((a,l)=>{const c=!r.isQuery&&r.index===l;return e("li",{class:["slimsearch-record-matches",{active:c}],role:"option","aria-selected":c},e(I,{to:a.link,onClick:()=>{f()}},()=>[e(E,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[a.header?e("div",{class:"slimsearch-record-content-header"},a.header):null,e("div",a.display.map(i=>A(i)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:u.value.remove,"aria-label":u.value.remove,innerHTML:T,onClick:i=>{i.preventDefault(),i.stopPropagation(),g(l)}})]))}))]));return te("keydown",a=>{if(s.isFocusing){if(L.value){if(a.key==="ArrowUp")_();else if(a.key==="ArrowDown")Y();else if(a.key==="Enter"){const l=S.value.contents[h.value];H(s.queries.join(" ")),k(l),n.push(w(l)),f()}}else if(a.key==="ArrowUp")P();else if(a.key==="ArrowDown")$();else if(a.key==="Enter"){const{index:l}=r;r.isQuery?(a.preventDefault(),o("updateQuery",d.value[l])):(n.push(v.value[l].link),f())}}}),se([t,h],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:s.queries.length?!L.value:!q.value}]},s.queries.length?Q.value?e(ue,{hint:u.value.searching}):L.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},y.value.map(({title:a,contents:l},c)=>{const i=t.value===c;return e("div",{class:["slimsearch-record",{active:i}],role:"group","aria-selected":i},[e("div",{class:"slimsearch-record-title"},a||u.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},l.map((m,K)=>{const F=i&&h.value===K;return e("li",{class:["slimsearch-record-matches",{active:F}],role:"option","aria-selected":F},e(I,{to:w(m),onClick:()=>{H(s.queries.join(" ")),k(m),f()}},()=>[m.type==="text"?null:e(m.type==="title"?re:m.type==="heading"?oe:ne,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[m.type==="text"&&m.header?e("div",{class:"slimsearch-record-content-header"},m.header):null,e("div",N(m))])]))}))])})):u.value.emptyResult:q.value?[V(),G()]:u.value.emptyHistory)}});export{Le as default};
